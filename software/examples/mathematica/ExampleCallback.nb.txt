Needs["NETLink`"]
LoadNETAssembly["Tinkerforge",NotebookDirectory[]<>"../../.."]

host="localhost"
port=4223
uid="6etgnL"(* Change to your UID *)

(* Create IPConnection and device object *)
ipcon=NETNew["Tinkerforge.IPConnection"]
s=NETNew["Tinkerforge.BrickServo",uid,ipcon]
ipcon@Connect[host,port]

(* PositionReachedCB will be called every time a position set with *)
(* SetPosition is reached *)
PositionReachedCB[sender_,servoNum_,position_]:=
 Module[{},
  If[position==9000,
   Print["Position: 90°, going to -90°"];
   sender@SetPosition[servoNum,-9000]
  ];
  If[position==-9000,
   Print["Position: -90°, going to 90°"];
   sender@SetPosition[servoNum,9000]
  ];
 ]

AddEventHandler[s@PositionReached,PositionReachedCB]
s@EnablePositionReachedCallback[]

(* Set velocity to 100°/s.This has to be smaller or equal to *)
(* maximum velocity of the servo,otherwise ReachedCB will be *)
(* called too early *)
s@SetVelocity[0,10000]
s@SetPosition[0,9000]
s@Enable[0]

Input["Click OK to exit"]

(* Clean up *)
ipcon@Disconnect[]
ReleaseNETObject[dc]
ReleaseNETObject[ipcon]
